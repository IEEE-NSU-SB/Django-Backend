{% block members_table %}
{% load static %}
<style>
  table th, table td {
    text-align: center;
  }
  table tr:nth-child(even) {
    background-color: #f2f2f2;
  }
  .table-responsive {
    overflow-x: auto;
    max-width: 100%;
    height: 400px;
  }
  .pagination-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 6px;
  }
  .pagination li {
    display: inline-block;
    padding: 6px 12px;
    border: 1px solid #00629B;
    background-color: #fff;
    color: #00629B;
    cursor: pointer;
    border-radius: 4px;
    font-size: 14px;
  }
  .pagination li.active {
    background-color: #00629B;
    color: #fff;
    font-weight: bold;
  }
  .pagination li.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .rows_count {
    text-align: center;
    margin-top: 10px;
    font-size: 14px;
    color: #00629B;
  }
  .header_wrap {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    padding-bottom: 10px;
    gap: 10px;
  }
   .tb_search{
    width: 40%;
    float: left;
  }
  .num_rows {
    width: 20%;
    float: right;
  }
  @media screen and (max-width: 768px) {
    .header_wrap {
      flex-direction: column;
    }
    .pagination li{
      font-size: 9px;
    }
  }
  thead th {
    position: sticky;
    top: 0;
    background-color: #00629B;
    color: #fff;
  }
</style>

<h3 style="color:#00629B;text-align:center;">All Registered Members of IEEE NSU Student Branch</h3>

<div class="container">
  <div class="header_wrap">
    <div class="tb_search">
      <input type="text" id="search_input_all" onkeyup="FilterkeyWord_all_table()" placeholder="Search by id, mail, blood group" class="form-control">
    </div>
    <div class="num_rows">
      <select class="form-control" id="maxRows">
        <option value="10">10 rows</option>
        <option value="15">15 rows</option>
        <option value="20">20 rows</option>
        <option value="50">50 rows</option>
        <option value="5000">Show ALL</option>
      </select>
    </div>
    
  </div>

  <div class="table-responsive">
    <table class="table table-striped" id="table-id">
      <thead>
        <tr>
          <th>SL No.</th>
          <th>IEEE ID</th>
          <th>NSU ID</th>
          <th>Name</th>
          <th>IEEE Email</th>
          <th>NSU Email</th>
          <th>Blood Group</th>
        </tr>
      </thead>
      <tbody>
        {% for member in members %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td><a href="{% url 'main_website:member_profile' member.ieee_id %}" style="color:#00629B">{{ member.ieee_id }}</a></td>
          <td>{{ member.nsu_id }}</td>
          <td>{{ member.name }}</td>
          <td>{{ member.email_ieee }}</td>
          <td>{{ member.email_nsu }}</td>
          <td>{{ member.blood_group }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="pagination-container">
    <ul class="pagination"></ul>
  </div>
  <div class="rows_count"></div>
</div>

<script src="{% static 'script/jquery.js' %}"></script>
<script>
$(document).ready(function () {
  function paginateTable(table, maxRows) {
    const totalRows = $(table + ' tbody tr').length;
    const totalPages = Math.ceil(totalRows / maxRows);
    const pagination = $('.pagination');
    const rowsCountBox = $('.rows_count');

    function showPage(page) {
      const start = (page - 1) * maxRows;
      const end = start + maxRows;

      $(table + ' tbody tr').hide().slice(start, end).show();

      rowsCountBox.text(`Showing ${start + 1} to ${Math.min(end, totalRows)} of ${totalRows} entries`);
      renderPagination(page);
    }

    function renderPagination(currentPage) {
      let pageHTML = '';

      if (maxRows >= totalRows) {
        // Hide pagination completely
        pagination.html('');
        rowsCountBox.text(`Showing 1 to ${totalRows} of ${totalRows} entries`);
        return;
      }

      // Prev Button
      pageHTML += `<li data-page="prev" class="${currentPage === 1 ? 'disabled' : ''}">« Prev</li>`;

      // Always show page 1
      if (currentPage > 2) {
        pageHTML += `<li data-page="1">1</li>`;
      }

      // Left dots
      if (currentPage > 3) {
        pageHTML += `<li class="disabled">...</li>`;
      }

      // Page before current
      if (currentPage - 1 > 1) {
        pageHTML += `<li data-page="${currentPage - 1}">${currentPage - 1}</li>`;
      }

      // Current page
      pageHTML += `<li class="active" data-page="${currentPage}">${currentPage}</li>`;

      // Page after current
      if (currentPage + 1 < totalPages) {
        pageHTML += `<li data-page="${currentPage + 1}">${currentPage + 1}</li>`;
      }

      // Right dots
      if (currentPage < totalPages - 2) {
        pageHTML += `<li class="disabled">...</li>`;
      }

      // Last page
      if (currentPage < totalPages - 1) {
        pageHTML += `<li data-page="${totalPages}">${totalPages}</li>`;
      }

      // Next Button
      pageHTML += `<li data-page="next" class="${currentPage === totalPages ? 'disabled' : ''}">Next »</li>`;

      pagination.html(pageHTML);

      // Pagination click
      pagination.find('li').off('click').on('click', function () {
        if ($(this).hasClass('disabled') || $(this).hasClass('active')) return;

        let selected = $(this).data('page');
        if (selected === 'prev') selected = currentPage - 1;
        if (selected === 'next') selected = currentPage + 1;

        showPage(parseInt(selected));
      });
    }

    showPage(1);
  }

  $('#maxRows').on('change', function () {
    paginateTable('#table-id', parseInt($(this).val()));
  }).trigger('change');
});

</script>
{% endblock members_table %}
