{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="{% static 'logos/logo.gif' %}" />
    <title>Meeting Minutes</title>

    <!--Sweet Alert-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    {% block common_css %} {% include "common_css.html" %} {% endblock common_css %}
    <style>
      .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        font-size: 2em;
        text-align: center;
        margin-bottom: 20px;
        margin-top: 20px;
        color: #00629b;
      }

      .search-filter {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 20px;
        margin: bottom;
        position: relative;
      }

      .search-filter input {
        text-decoration: none;
        border-radius: 4px;
        border: 1px solid transparent;
        height: 26px;
        padding: 16px;
        border: 1px solid #d9d9d9;
        padding: 16px 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .filter {
        border-radius: 4px;
        /* border: 1px solid rgb(76 76 171); */
        color: rgb(76 76 171);
        background-color: rgb(206, 206, 254);
        padding: 3px 16px;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
        margin: 0;
      }
      .filter:hover {
        background-color: rgb(155, 155, 255);
      }

      .filter-options {
        position: absolute;
        right: 0;
        top: 40px;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: none;
        flex-direction: column;
        z-index: 102;
        padding: 16px;
        width: 200px;
      }
      
      .filter-options label {
        margin-bottom: 5px;
      }
      
      .filter-options input {
        margin-bottom: 10px;
        padding:18px 10px;
        width: 100%;
      }
      
      .filter-options select {
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
        padding: 10px;
        width: 100%;
      }

      .filter-options button {
        background: #002b5b;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
      }

      .table-container {
        max-height: 400px;
        overflow-y: auto;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        /* table-layout: fixed; */
      }

      thead tr {
        background-color: #ffffff;
        position: sticky;
        top: 0;
        z-index: 1;
      }

      th,
      td {
        padding: 10px 16px;
        text-align: center;
        border-bottom: 1px solid rgba(120, 130, 140, 0.045);
      }
      th {
        background: #f0f0f0;
        font-weight: bold;
        color: #333;
      }

      table tr:nth-child(even) {
        background-color: white;
      }
      table tr {
        background-color: white;
      }
      td .ellipsis {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display: block;
        max-width: 100%;
      }

      .download-icon {
        cursor: pointer;
        font-size: 18px;
      }

      .create_btn {
        border-radius: 4px;
        border: 1px solid transparent;
        color: rgb(76, 171, 92);
        background-color: rgb(213, 251, 219);
        padding: 3px 16px;
        transition: all 0.3s ease-in-out;
        cursor: pointer;
        margin: 0;
      }
      .create_btn:hover {
        background-color: rgb(149, 255, 165);
        /* color: rgb(213, 251, 219); */
      }
      .buttons {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }
      .table-responsive {
        overflow-x: hidden;
        max-height: 400px;
      }
      .table-responsive th {
        position: sticky;
        top: -2px;
      }
      .meeting-minutes-table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 6px;
      }

      .meeting-minutes-table th,
      .meeting-minutes-table td {
        padding: 10px;
        text-align: center;
        border-bottom: 1px solid #ddd;
      }

      .meeting-minutes-table th {
        background-color: #f0f0f0;
      }

      .meeting-minutes-table tr:hover {
        background-color: #f9f9f9;
      }
      .download-btn {
        border: none;
        padding: 0.5rem;
        cursor: pointer;
        transition: background-color 0.3s ease-in-out;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        background-color: transparent;
        color: #00629b;
      }
      @media (max-width: 600px) {
        .search-filter {
          flex-direction: column;
          align-items: flex-start;
        }

        .filter-options {
          position: static;
          width: 100%;
        }
      }
      @media screen and (max-width: 700px) {
        .table-responsive {
          overflow-x: scroll;
          width: 500px;
        }
      }
      @media screen and (max-width: 600px) {
        .table-responsive {
          width: 400px;
        }
      }
      @media screen and (max-width: 450px) {
        .table-responsive {
          width: 350px;
        }
      }
    </style>
  </head>
  <body style="background-color: white">
    <!-- ############ LAYOUT START-->
    <div class="app" id="app" style="background-color: white">
      <!-- aside -->
      <div id="aside" class="app-aside modal nav-dropdown">
        {% block sidebar %} {% include 'users/sidebar.html' %} {% endblock %}
      </div>
      <!-- aside end -->

      <!-- navbar content -->
      <div id="content" class="app-content box-shadow-z0" role="main">
        {% if primary == 1%}
            {% if team_primary is None %}
              {% block navbar %}
                  {% include 'navbar.html' %}
              {% endblock navbar %}
            {% else %}
              {% if team_namespace == 'content_writing_and_publications_team' %}
              {% block caw_navbar %}
                  {% include 'content_navbar.html' %} 
              {% endblock caw_navbar %}
    
              {% elif team_namespace == 'events_and_management_team' %}
              {% block emt_navbar %}
                  {% include 'emt_navbar.html' %} 
              {% endblock emt_navbar %}
    
              {% elif team_namespace == 'logistics_and_operations_team' %}
              {% block lot_navbar %}
                  {% include 'logistics_navbar.html' %} 
              {% endblock lot_navbar %}
    
              {% elif team_namespace == 'promotions_team' %}
              {% block promotion_navbar %}
                  {% include 'promotions_team/promotions_navbar.html' %} 
              {% endblock promotion_navbar %}
    
              {% elif team_namespace == 'public_relation_team' %}
              {% block prt_navbar %}
                  {% include 'public_relation_team/public_relation_navbar.html' %} 
              {% endblock prt_navbar %}
    
              {% elif team_namespace == 'membership_development_team' %}
              {% block mdt_navbar %}
                  {% include 'mdt_navbar.html' %} 
              {% endblock mdt_navbar %}
    
              {% elif team_namespace == 'media_team' %}
              {% block media_navbar %}
                  {% include 'media_navbar.html' %} 
              {% endblock media_navbar %}
    
              {% elif team_namespace == 'graphics_team' %}
              {% block graphics_navbar %}
                  {% include 'graphics_navbar.html' %} 
              {% endblock graphics_navbar %}
    
              {% elif team_namespace == 'finance_and_corporate_team' %}
              {% block finance_navbar %}
                  {% include 'finance_and_corporate_team/finance_navbar.html' %} 
              {% endblock finance_navbar %}
    
              {% elif team_namespace == 'website_development_team' %}
              {% block web_navbar %}
                  {% include 'website_development_team/web_navbar.html' %} 
              {% endblock web_navbar %}
    
              {% endif %}
            {% endif %}
        {% else %}
            {% block sc_ag_navbar %}
                {% include 'sc_ag_navbar.html' %}
            {% endblock sc_ag_navbar %}

        {% endif %}
      </div>
      <!--navbar content end-->

      <!-- ############ PAGE START-->
      <div ui-view class="app-body" style="justify-content: center" id="view">
        <!--START PAGE CODE-->
        <div class="container">
          <div class="header">Meeting Minutes</div>
          <div class="search-filter">
            <input
              type="text"
              id="searchInput"
              placeholder="Search..."
              onkeyup="searchTable()"
            />
            <div class="buttons">
              {% if has_meeting_minutes_create_access %}
              <button
                type="button"
                class="create_btn"
                id="create-account-btn"
                {% if primary == 1 %}
                {% if team_primary is not None %}
                onclick="window.location.href='{% url create_url team_primary %}'">
                {% else %}
                onclick="window.location.href='{% url 'central_branch:meeting_minutes:meeting_minutes_create' %}'">
                {% endif %}
                {% else %}
                onclick="window.location.href='{% url 'chapters_and_affinity_group:meeting_minutes:meeting_minutes_create' primary %}'">
                {% endif %}
                Create Meeting Minutes
              </button>
              {% endif %}
              <p class="filter" onclick="toggleFilterOptions()">
                Filter <i class="fa fa-filter" aria-hidden="true"></i>
              </p>
              <div id="filterOptions" class="filter-options">
              {% comment %} <label for="tenureInput">By Tenure</label>
              <input type="text" id="tenureInput" placeholder="e.g., 2025" /> {% endcomment %}
              <label for="monthSelect">By Month</label>
              <select id="monthSelect">
                <option value="">All</option>
                <option value="january">January</option>
                <option value="february">February</option>
                <option value="march">March</option>
                <option value="april">April</option>
                <option value="may">May</option>
                <option value="june">June</option>
                <option value="july">July</option>
                <option value="august">August</option>
                <option value="september">September</option>
                <option value="october">October</option>
                <option value="november">November</option>
                <option value="december">December</option>
              </select>

              <label for="locationSelect">By Location</label>
              <select id="locationSelect">
                <option value="">All</option>
                <option value="in-person">In-person</option>
                <option value="hybrid">Hybrid</option>
                <option value="virtual">Virtual</option>
              </select>

              <button onclick="applyCustomFilters()">Apply Filters</button>
              <button onclick="clearFilters()" style="margin-top: 8px;">Clear Filters</button>
            </div>
            </div>
          </div>
          <br />
          <div class="table-responsive table_box table-container">
            <table class="meeting-minutes-table table" id="event">
              <thead style="position: relative; z-index: 101">
                <tr>
                  <th>SL</th>
                  <th>Meeting Name</th>
                  <th>Location</th>
                  <th>Date</th>
                  <th>Download</th>
                </tr>
              </thead>
              <tbody id="tableBody">
                {% for meeting in meetings %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>
                      {% if primary == 1%}
                      {% if team_primary is not None %}
                      <a href="{% url edit_url team_primary meeting.pk %}" style="color:#0050ac; text-decoration: none">
                      {% else %}
                      <a href="{% url 'central_branch:meeting_minutes:meeting_minutes_edit' meeting.pk %}" style="color:#0050ac; text-decoration: none">
                      {% endif %}
                      {% else %}
                      <a href="{% url 'chapters_and_affinity_group:meeting_minutes:meeting_minutes_edit' primary meeting.pk %}" style="tcolor:#0050ac; ext-decoration: none">
                      {% endif %}
                      {{ meeting.meeting_name }}
                        </a>
                  </td>
                  <td>{{ meeting.location }}</td>
                  <td>{{ meeting.meeting_date }}</td>
                  <td>
                    <a
                    {% if primary == 1 %}
                    href="{% url 'central_branch:meeting_minutes:download_meeting_pdf' meeting.pk %}"
                    {% else %}
                    href="{% url 'chapters_and_affinity_group:meeting_minutes:download_meeting_pdf' primary meeting.pk %}"
                    {% endif %}
                    >
                      <i class="fa fa-download download-icon"></i>
                    </a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4">No meeting minutes found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
  {% block common_js %} {% include "common_js.html" %} {% endblock common_js %}
  <script>
    function searchTable() {
      const filter = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#tableBody tr");

      rows.forEach((row) => {
        const meetingNameCell = row.querySelector("td:nth-child(2)");
        if (meetingNameCell) {
          const text = meetingNameCell.textContent.toLowerCase();
          row.style.display = text.includes(filter) ? "" : "none";
        }
      });
    }
    
    function applyCustomFilters() {
      const selectedMonth = document.getElementById("monthSelect").value;
      const selectedLocation = document.getElementById("locationSelect").value;

      const tableBody = document.getElementById("tableBody");
      const rows = Array.from(tableBody.querySelectorAll("tr"));

      rows.forEach((row) => {
        const dateCell = row.children[3];
        const locationCell = row.children[2];

        if (!dateCell || !locationCell) return;

        const fullDate = dateCell.getAttribute("data-full-date") || dateCell.textContent.trim();
        const monthFromDate = fullDate.split(" ")[0].toLowerCase();
        const locationText = locationCell.textContent.trim().toLowerCase();

        const monthMatches = !selectedMonth || monthFromDate === selectedMonth;
        const locationMatches = !selectedLocation || locationText === selectedLocation;

        row.style.display = (monthMatches && locationMatches) ? "" : "none";
      });

      toggleFilterOptions();
    }

    function clearFilters() {
      document.getElementById("monthSelect").value = "";
      document.getElementById("locationSelect").value = "";

      const tableBody = document.getElementById("tableBody");
      const rows = Array.from(tableBody.querySelectorAll("tr"));
      rows.forEach(row => {
        row.style.display = "";
      });
    }

    function toggleFilterOptions() {
      const options = document.getElementById("filterOptions");
      options.style.display = options.style.display === "flex" ? "none" : "flex";
    }

    // Optional: Run on page load to shorten month names
    document.addEventListener("DOMContentLoaded", () => {
      const rows = document.querySelectorAll("#tableBody tr");
      rows.forEach(row => {
        const dateCell = row.children[3];
        if (dateCell) {
          const fullDate = dateCell.textContent.trim();
          const parts = fullDate.split(" ");
          if (parts.length >= 3 && parts[0].length > 4) {
            const shortMonth = parts[0].substring(0, 3) + ".";
            const shortDate = [shortMonth, parts[1], parts[2]].join(" ");
            dateCell.setAttribute("data-full-date", fullDate); // store original
            dateCell.textContent = shortDate;
          }
        }
      });
    });
  </script>
</html>
